<!DOCTYPE html>
<html>
<head>
    <title>Tic-Tac-Toe WebSocket Test</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
    <h1>Tic-Tac-Toe WebSocket Backend - Test Page</h1>
    <div>
        <h2>Connection Status: <span id="status">Disconnected</span></h2>
        <button onclick="connect()">Connect</button>
        <button onclick="disconnect()">Disconnect</button>
    </div>
    
    <div>
        <h3>Create Room</h3>
        <input type="text" id="playerName1" placeholder="Player Name">
        <button onclick="createRoom()">Create Room</button>
    </div>
    
    <div>
        <h3>Join Room</h3>
        <input type="text" id="roomIdInput" placeholder="Room ID">
        <input type="text" id="playerName2" placeholder="Player Name">
        <button onclick="joinRoom()">Join Room</button>
    </div>
    
    <div>
        <h3>Make Move</h3>
        <input type="text" id="moveRoomId" placeholder="Room ID">
        <input type="text" id="movePlayerId" placeholder="Player ID">
        <input type="number" id="movePosition" placeholder="Position (0-8)" min="0" max="8">
        <button onclick="makeMove()">Make Move</button>
    </div>
    
    <div>
        <h3>Messages:</h3>
        <pre id="messages"></pre>
    </div>

    <script>
        let stompClient = null;
        let currentRoomId = null;

        function connect() {
            const socket = new SockJS('/ws/tictactoe');
            stompClient = Stomp.over(socket);
            stompClient.connect({}, function(frame) {
                document.getElementById('status').textContent = 'Connected';
                console.log('Connected: ' + frame);
            }, function(error) {
                document.getElementById('status').textContent = 'Error';
                console.error('Error: ' + error);
            });
        }

        function disconnect() {
            if (stompClient !== null) {
                stompClient.disconnect();
            }
            document.getElementById('status').textContent = 'Disconnected';
        }

        function subscribeToRoom(roomId) {
            if (stompClient && stompClient.connected) {
                stompClient.subscribe('/topic/room/' + roomId, function(message) {
                    showMessage(JSON.parse(message.body));
                });
            }
        }

        function createRoom() {
            const playerName = document.getElementById('playerName1').value;
            if (stompClient && stompClient.connected) {
                stompClient.send("/app/createRoom", {}, JSON.stringify({
                    playerName: playerName
                }));
                // Subscribe after sending
                setTimeout(() => {
                    const roomId = prompt("Enter the roomId from the response:");
                    if (roomId) {
                        currentRoomId = roomId;
                        subscribeToRoom(roomId);
                    }
                }, 1000);
            }
        }

        function joinRoom() {
            const roomId = document.getElementById('roomIdInput').value;
            const playerName = document.getElementById('playerName2').value;
            currentRoomId = roomId;
            subscribeToRoom(roomId);
            
            if (stompClient && stompClient.connected) {
                stompClient.send("/app/joinRoom", {}, JSON.stringify({
                    roomId: roomId,
                    playerName: playerName
                }));
            }
        }

        function makeMove() {
            const roomId = document.getElementById('moveRoomId').value;
            const playerId = document.getElementById('movePlayerId').value;
            const position = parseInt(document.getElementById('movePosition').value);
            
            if (stompClient && stompClient.connected) {
                stompClient.send("/app/makeMove", {}, JSON.stringify({
                    roomId: roomId,
                    playerId: playerId,
                    position: position
                }));
            }
        }

        function showMessage(message) {
            const messagesDiv = document.getElementById('messages');
            messagesDiv.textContent += JSON.stringify(message, null, 2) + '\n\n';
            console.log('Received:', message);
        }
    </script>
</body>
</html>
